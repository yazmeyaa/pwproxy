# Exact domains — authoritative, no forward.
# HTTPS/SVCB queries return NODATA, blocking ECH key discovery.
(exact) {
    log
    hosts {
        217.30.10.72 pw.game ns.photonengine.io
        ttl 60
        no_reverse
    }
}

# Wildcards + catch-all — with forward for unmatched queries.
(wildcard_and_catchall) {
    log

    # *.exitgames.com
    template IN A exitgames.com {
        match "^.+\.exitgames\.com\.$"
        answer "{{ .Name }} 60 IN A 217.30.10.72"
        fallthrough
    }
    template IN AAAA exitgames.com {
        match "^.+\.exitgames\.com\.$"
        rcode NOERROR
        fallthrough
    }

    # notpix-3d-content.*.digitaloceanspaces.com
    # not-platform.*.cdn.digitaloceanspaces.com
    template IN A digitaloceanspaces.com {
        match "^(notpix-3d-content\.[^.]+\.digitaloceanspaces\.com|not-platform\.[^.]+\.cdn\.digitaloceanspaces\.com)\.$"
        answer "{{ .Name }} 60 IN A 217.30.10.72"
        fallthrough
    }
    template IN AAAA digitaloceanspaces.com {
        match "^(notpix-3d-content\.[^.]+\.digitaloceanspaces\.com|not-platform\.[^.]+\.cdn\.digitaloceanspaces\.com)\.$"
        rcode NOERROR
        fallthrough
    }

    forward . 1.1.1.1 8.8.8.8
    cache 30
}

# Plain DNS
pw.game ns.photonengine.io {
    import exact
}
. {
    import wildcard_and_catchall
}

# DoT
tls://pw.game tls://ns.photonengine.io {
    tls /certs/cert.pem /certs/key.pem
    import exact
}
tls://. {
    tls /certs/cert.pem /certs/key.pem
    import wildcard_and_catchall
}

# DoH
https://pw.game:8443 https://ns.photonengine.io:8443 {
    tls /certs/cert.pem /certs/key.pem
    import exact
}
https://.:8443 {
    tls /certs/cert.pem /certs/key.pem
    import wildcard_and_catchall
}
