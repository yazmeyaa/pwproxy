# Shared interception logic — imported by each protocol block below.
(intercept) {
    log

    hosts {
        217.30.10.72 pw.game ns.photonengine.io
        ttl 60
        no_reverse
        fallthrough
    }

    # *.exitgames.com
    template IN A exitgames.com {
        match "^.+\.exitgames\.com\.$"
        answer "{{ .Name }} 60 IN A 217.30.10.72"
        fallthrough
    }
    template IN AAAA exitgames.com {
        match "^.+\.exitgames\.com\.$"
        rcode NOERROR
        fallthrough
    }

    # notpix-3d-content.*.digitaloceanspaces.com
    # not-platform.*.cdn.digitaloceanspaces.com
    template IN A digitaloceanspaces.com {
        match "^(notpix-3d-content\.[^.]+\.digitaloceanspaces\.com|not-platform\.[^.]+\.cdn\.digitaloceanspaces\.com)\.$"
        answer "{{ .Name }} 60 IN A 217.30.10.72"
        fallthrough
    }
    template IN AAAA digitaloceanspaces.com {
        match "^(notpix-3d-content\.[^.]+\.digitaloceanspaces\.com|not-platform\.[^.]+\.cdn\.digitaloceanspaces\.com)\.$"
        rcode NOERROR
        fallthrough
    }

    forward . 1.1.1.1 8.8.8.8
    cache 30
}

# Plain DNS
. {
    import intercept
}

# DoT
tls://. {
    tls /certs/cert.pem /certs/key.pem
    import intercept
}

# DoH (port 8443 — 443 is used by HAProxy)
https://.:8443 {
    tls /certs/cert.pem /certs/key.pem
    import intercept
}
